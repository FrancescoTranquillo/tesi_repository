library(rlist)
library(viridis)
pairs <- cbind(nome[-length(nome)], nome[-1])
dftot <- apply(pairs, MARGIN =1, function(j) plyr::count(tab,j)) %>%
lapply(.,setNames, nm=c("source","target", "value")) %>%
do.call("rbind",.)
dftot$source <- as.character(dftot$source)
dftot$target <- as.character(dftot$target)
source <- dftot$source
target <- dftot$target
value <- dftot$value
actors <- unique(c(dftot$source, dftot$target))
l <- length(actors)
actors_t <- data.frame("actors" = actors, "id" = 0:(l - 1))
convert_name_id <- function(node_name) {
actors_t$id[which(actors_t$actors %in% node_name)]
}
sankey_list <-
list(
nodes = data.frame("actors" = factor(actors_t$actors)),
links = data.frame(
"source" = sapply(source, convert_name_id, USE.NAMES = F),
"target" = sapply(target, convert_name_id, USE.NAMES = F),
"value" = value
)
)
sankey_list$nodes <- mutate(sankey_list$nodes,"nodecolor" = viridis(nlevels(sankey_list$nodes$actors), alpha = 0.6, option ="viridis"))
sankey_list$links <- mutate(sankey_list$links,"linkcolor" = viridis(nlevels(sankey_list$links), alpha = 0.2, option ="viridis"))
return(sankey_list)
}
stb <- sankey_table(df,c("ESITO.CICLO","CATEGORIA","MATRICOLA"))
nome <- c("ESITO.CICLO","CATEGORIA","MATRICOLA")
pairs <- cbind(nome[-length(nome)], nome[-1])
dftot <- apply(pairs, MARGIN =1, function(j) plyr::count(tab,j)) %>%
lapply(.,setNames, nm=c("source","target", "value")) %>%
do.call("rbind",.)
tab <- df
pairs <- cbind(nome[-length(nome)], nome[-1])
dftot <- apply(pairs, MARGIN =1, function(j) plyr::count(tab,j)) %>%
lapply(.,setNames, nm=c("source","target", "value")) %>%
do.call("rbind",.)
dftot$source <- as.character(dftot$source)
dftot$target <- as.character(dftot$target)
source <- dftot$source
target <- dftot$target
value <- dftot$value
actors <- unique(c(dftot$source, dftot$target))
l <- length(actors)
actors_t <- data.frame("actors" = actors, "id" = 0:(l - 1))
convert_name_id <- function(node_name) {
actors_t$id[which(actors_t$actors %in% node_name)]
}
sankey_list <-
list(
nodes = data.frame("actors" = factor(actors_t$actors)),
links = data.frame(
"source" = sapply(source, convert_name_id, USE.NAMES = F),
"target" = sapply(target, convert_name_id, USE.NAMES = F),
"value" = value
)
)
sankey_list$nodes <- mutate(sankey_list$nodes,"nodecolor" = viridis(nlevels(sankey_list$nodes$actors), alpha = 0.6, option ="viridis"))
sankey_list$links <- mutate(sankey_list$links,"linkcolor" = viridis(nlevels(sankey_list$links), alpha = 0.2, option ="viridis"))
sankey_list$links
length(sankey_list$links)
nrow(sankey_list$links)
sankey_table <- function(tab,nome){
library(rlist)
library(viridis)
pairs <- cbind(nome[-length(nome)], nome[-1])
dftot <- apply(pairs, MARGIN =1, function(j) plyr::count(tab,j)) %>%
lapply(.,setNames, nm=c("source","target", "value")) %>%
do.call("rbind",.)
dftot$source <- as.character(dftot$source)
dftot$target <- as.character(dftot$target)
source <- dftot$source
target <- dftot$target
value <- dftot$value
actors <- unique(c(dftot$source, dftot$target))
l <- length(actors)
actors_t <- data.frame("actors" = actors, "id" = 0:(l - 1))
convert_name_id <- function(node_name) {
actors_t$id[which(actors_t$actors %in% node_name)]
}
sankey_list <-
list(
nodes = data.frame("actors" = factor(actors_t$actors)),
links = data.frame(
"source" = sapply(source, convert_name_id, USE.NAMES = F),
"target" = sapply(target, convert_name_id, USE.NAMES = F),
"value" = value
)
)
sankey_list$nodes <- mutate(sankey_list$nodes,"nodecolor" = viridis(nlevels(sankey_list$nodes$actors), alpha = 0.6, option ="viridis"))
sankey_list$links <- mutate(sankey_list$links,"linkcolor" = viridis(nrow(sankey_list$links), alpha = 0.2, option ="viridis"))
return(sankey_list)
}
stb <- sankey_table(df,c("ESITO.CICLO","CATEGORIA","MATRICOLA"))
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value
)
)
p
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
)
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
)
p
stb <- sankey_table(df,c("CATEGORIA","MATRICOLA"))
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
)
p
stb <- sankey_table(df[which(df$ESITO.CICLO%in%"CICLO IRREGOLARE"&df$CATEGORIA%in%"BRONCOSCOPIO")],
c("CATEGORIA","MATRICOLA"))
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
)
stb <- sankey_table(df[which(df$ESITO.CICLO%in%"CICLO IRREGOLARE"&df$CATEGORIA%in%"BRONCOSCOPIO"),],
c("CATEGORIA","MATRICOLA"))
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
)
p
stb <- sankey_table(df[which(df$ESITO.CICLO%in%"CICLO IRREGOLARE"&df$CATEGORIA%in%"BRONCOSCOPIO"),],
c("CATEGORIA","MATRICOLA","ALLARMI"))
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
)
p
stb <- sankey_table(df[which(df$ESITO.CICLO%in%"CICLO IRREGOLARE"&df$CATEGORIA%in%"BRONCOSCOPIO"),],
c("ALLARMI","MATRICOLA"))
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
)
p
stb <- sankey_table(df[which(df$ESITO.CICLO%in%"CICLO IRREGOLARE"&df$CATEGORIA%in%"BRONCOSCOPIO"&df$ALLARMI!%in%"Nessun allarme rilevato"),],
c("ALLARMI","MATRICOLA"))
stb <- sankey_table(df[which(df$ESITO.CICLO%in%"CICLO IRREGOLARE"&df$CATEGORIA%in%"BRONCOSCOPIO"&!df$ALLARMI%in%"Nessun allarme rilevato"),],
c("ALLARMI","MATRICOLA"))
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
)
p
mtcars
ezsankey <- function(tab,nome){
stb <- sankey_table(tab,nome)
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
)
return(p)
}
ezsankey(df,c("ESITO.CICLO", "MATRICOLA", "ALLARMI","TIPO.CICLO"))
ezsankey(df[!which(df$ALLARMI%in%"Nessun allarme rilevato"),],c("ESITO.CICLO", "MATRICOLA", "ALLARMI","TIPO.CICLO"))
ezsankey(df[-which(df$ALLARMI%in%"Nessun allarme rilevato"),],c("ESITO.CICLO", "MATRICOLA", "ALLARMI","TIPO.CICLO"))
ezsankey(df[-which(df$ALLARMI%in%"Nessun allarme rilevato"),],c("TIPO.CICLO","ESITO.CICLO", "MATRICOLA", "ALLARMI"))
ezsankey(df[-which(df$ALLARMI%in%"Nessun allarme rilevato"),],c("TIPO.CICLO","ESITO.CICLO", "MATRICOLA", "ALLARMI"))
ezsankey(df[-which(df$ALLARMI%in%"Nessun allarme rilevato"),],c("ESITO.CICLO", "MATRICOLA", "ALLARMI"))
ezsankey(df[which(!df$ALLARMI%in%"Nessun allarme rilevato"&df$CATEGORIA%in%c("BRONCOSCOPIO","DUODENOSCOPIO"),],c("ESITO.CICLO", "MATRICOLA", "ALLARMI"))
ezsankey(df[which(!df$ALLARMI%in%"Nessun allarme rilevato"&df$CATEGORIA%in%c("BRONCOSCOPIO","DUODENOSCOPIO")),],c("ESITO.CICLO", "MATRICOLA", "ALLARMI"))
ezsankey(df[which(!df$ALLARMI%in%"Nessun allarme rilevato"&df$CATEGORIA%in%c("BRONCOSCOPIO","DUODENOSCOPIO")),],
c("ESITO.CICLO", "CATEGORIA","MATRICOLA", "ALLARMI"))
}
ezsankey <- function(tab,nome){
stb <- sankey_table(tab,nome)
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
) %>%
layout(font = list(size = 4))
return(p)
}
ezsankey(df[which(!df$ALLARMI%in%"Nessun allarme rilevato"&df$CATEGORIA%in%c("BRONCOSCOPIO","DUODENOSCOPIO")),],
c("ESITO.CICLO", "CATEGORIA","MATRICOLA", "ALLARMI"))
ezsankey <- function(tab,nome){
stb <- sankey_table(tab,nome)
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
) %>%
layout(font = list(size = 14))
return(p)
}
ezsankey(df[which(!df$ALLARMI%in%"Nessun allarme rilevato"&df$CATEGORIA%in%c("BRONCOSCOPIO","DUODENOSCOPIO")),],
c("ESITO.CICLO", "CATEGORIA","MATRICOLA", "ALLARMI"))
dim(sankey_list$links)
product(dim(sankey_list$links))
apply(dim(sankey_list$links),*)
sapply(dim(sankey_list$links),*)
sankey_table <- function(tab,nome){
library(rlist)
library(viridis)
pairs <- cbind(nome[-length(nome)], nome[-1])
dftot <- apply(pairs, MARGIN =1, function(j) plyr::count(tab,j)) %>%
lapply(.,setNames, nm=c("source","target", "value")) %>%
do.call("rbind",.)
dftot$source <- as.character(dftot$source)
dftot$target <- as.character(dftot$target)
source <- dftot$source
target <- dftot$target
value <- dftot$value
actors <- unique(c(dftot$source, dftot$target))
l <- length(actors)
actors_t <- data.frame("actors" = actors, "id" = 0:(l - 1))
convert_name_id <- function(node_name) {
actors_t$id[which(actors_t$actors %in% node_name)]
}
sankey_list <-
list(
nodes = data.frame("actors" = factor(actors_t$actors)),
links = data.frame(
"source" = sapply(source, convert_name_id, USE.NAMES = F),
"target" = sapply(target, convert_name_id, USE.NAMES = F),
"value" = value
)
)
sankey_list$nodes <- mutate(sankey_list$nodes,"nodecolor" = viridis(nlevels(sankey_list$nodes$actors), alpha = 0.6, option ="viridis"))
sankey_list$links <- mutate(sankey_list$links,"linkcolor" = viridis((nrow(sankey_list$links)*ncol(sankey_list$links)), alpha = 0.2, option ="viridis"))
return(sankey_list)
}
stb <- sankey_table(df[which(df$ESITO.CICLO%in%"CICLO IRREGOLARE"&df$CATEGORIA%in%"BRONCOSCOPIO"&!df$ALLARMI%in%"Nessun allarme rilevato"),],
c("ALLARMI","MATRICOLA"))
p <- plot_ly(
type = "sankey",
orientation = "h",
arrangement = 'freeform',
node = list(
label=stb$nodes$actors,
thickness = 15,
pad=10,
color=stb$nodes$nodecolor,
line = list(color = "black",
width = 0.5)
),
link = list(
source = stb$links$source,
target = stb$links$target,
value = stb$links$value,
color=stb$links$linkcolor
)
)
stb <- sankey_table(df[which(df$ESITO.CICLO%in%"CICLO IRREGOLARE"&df$CATEGORIA%in%"BRONCOSCOPIO"&!df$ALLARMI%in%"Nessun allarme rilevato"),],
c("ALLARMI","MATRICOLA"))
nrow(sankey_list$links)*ncol(sankey_list$links)
View(sankey_list)
shiny::runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
shiny::runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
# library(here)
library(pbapply)
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
unloadNamespace()
rm(list=ls())
#
# This is a Shiny web application. You can run the application by clicking
# the 'Run App' button above.
#
# Find out more about building applications with Shiny here:
#
#    http://shiny.rstudio.com/
#
library(here)
library(shiny)
library(shinydashboard)
library(shinyalert)
library(shinyWidgets)
library(DT)
library(esquisse)
library(lubridate)
library(shinyBS)
library(plotly)
library(readr)
library(arm)
library(caret)
library(naivebayes)
library(dygraphs)
library(xts)
library(plyr)
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
rds <- as.list(list.files(here(),"*7_*"))
?list.files
runApp('ISA-test')
rds <- as.list(list.files(here(),"*7_*"))
runApp('ISA-test')
rds <- as.list(list.files(here::here(),"*7_*"))
modelli <- lapply(rds,function(x) readRDS(x))
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
shiny::runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
runApp('ISA-test')
